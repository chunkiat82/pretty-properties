$(document).ready(function () {

  var $container = $('.container');
  var $outputFormat = $("#diff-url-options-output-format");
  var $matching = $("#diff-url-options-matching");
  function main(data) {
    var outputFormatVal = $outputFormat.val();
    var matchingVal = $matching.val();

    var showFiles = true;
    var matching = 'words'
    var wordThreshold = 0.25;
    var matchingMaxComparisons = 2500;
    var outputFormat = outputFormatVal || 'line-by-line';
    var matching = matchingVal || 'words';

    var container = '#url-diff-container';
    var diff2htmlUi = new Diff2HtmlUI({ diff: Base64.decode(window.diffs) });

    if (outputFormat === 'side-by-side') {
      $container.css({ 'width': '100%' });
    } else {
      $container.css({ 'width': '' });
    }

    diff2htmlUi.draw(container, {
      outputFormat: outputFormat,
      showFiles: showFiles,
      matching: matching,
      matchWordsThreshold: wordThreshold,
      matchingMaxComparisons: matchingMaxComparisons,
      synchronisedScroll: true
    });
    diff2htmlUi.fileListCloseable(container, false);
    diff2htmlUi.highlightCode(container);
  }

  $outputFormat.add($matching).change(function () {
    main(window.diffs);
  })

  window.diffs && main(window.diffs);

});
